"use strict";(self.webpackChunkjump_game=self.webpackChunkjump_game||[]).push([[584],{7584:(t,s,n)=>{n.d(s,{WebGLRenderer:()=>Jt});var i=n(8507),e=n(9313),r=n(5611),o=n(4459),c=n(4e3),a=n(2067),h=n(6665),u=n(6040),l=n(8475),v=n(5811);class f{contextChange(t){const s=new v.k({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new e.u,type:"mat3x3<f32>"},uRound:{value:0,type:"f32"}}),n=t.limits.maxBatchableTextures,i=(0,r.I)({name:"graphics",bits:[o.a,(0,c.P)(n),a.mA,h.m]});this.shader=new l.M({glProgram:i,resources:{localUniforms:s,batchSamplers:(0,u.n)(n)}})}execute(t,s){const n=s.context,i=n.customShader||this.shader,e=t.renderer,r=e.graphicsContext,{batcher:o,instructions:c}=r.getContextRenderData(n);i.groups[0]=e.globalUniforms.bindGroup,e.state.set(t.state),e.shader.bind(i),e.geometry.bind(o.geometry,i.glProgram);const a=c.instructions;for(let t=0;t<c.instructionSize;t++){const s=a[t];if(s.size){for(let t=0;t<s.textures.count;t++)e.texture.bind(s.textures.textures[t],t);e.geometry.draw(s.topology,s.size,s.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}f.extension={type:[i.Ag.WebGLPipesAdaptor],name:"graphics"};var m=n(3391),g=n(5589),b=n(268);class _{init(){const t=(0,r.I)({name:"mesh",bits:[a.mA,m.m,h.m]});this.t=new l.M({glProgram:t,resources:{uTexture:g.g.EMPTY.source,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new e.u}}}})}execute(t,s){const n=t.renderer;let i=s.t;if(i){if(!i.glProgram)return void(0,b.R)("Mesh shader has no glProgram",s.shader)}else{i=this.t;const t=s.texture,n=t.source;i.resources.uTexture=n,i.resources.uSampler=n.style,i.resources.textureUniforms.uniforms.uTextureMatrix=t.textureMatrix.mapCoord}i.groups[100]=n.globalUniforms.bindGroup,i.groups[101]=t.localUniformsBindGroup,n.encoder.draw({geometry:s.o,shader:i,state:s.state})}destroy(){this.t.destroy(!0),this.t=null}}_.extension={type:[i.Ag.WebGLPipesAdaptor],name:"mesh"};var d=n(7547);class x{constructor(){this.h=d.U.for2d(),this._={}}init(t){t.renderer.runners.contextChange.add(this)}contextChange(){this._={}}start(t,s,n){const i=t.renderer,e=this._[n.uid];i.shader.bind(n,e),e||(this._[n.uid]=!0),i.shader.updateUniformGroup(i.globalUniforms.uniformGroup),i.geometry.bind(s,n.glProgram)}execute(t,s){const n=t.renderer;this.h.blendMode=s.blendMode,n.state.set(this.h);const i=s.textures.textures;for(let t=0;t<s.textures.count;t++)n.texture.bind(i[t],t);n.geometry.draw(s.topology,s.size,s.start)}}x.extension={type:[i.Ag.WebGLPipesAdaptor],name:"batch"};var p=n(800),E=n(1662),y=n(5099),T=n(1132),S=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(S||{});class A{constructor(t,s){this.p=-1,this.T=-1,this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.type=s}}class w{constructor(t){this.A=Object.create(null),this.N=Object.create(null),this.B=0,this.O=this.B,this.G=0,this.C=t,this.C.renderableGC.addManagedHash(this,"_gpuBuffers")}destroy(){this.C=null,this.L=null,this.A=null,this.N=null}contextChange(){this.L=this.C.gl,this.A=Object.create(null),this.D=this.C.limits.maxUniformBindings}getGlBuffer(t){return this.A[t.uid]||this.createGLBuffer(t)}bind(t){const{L:s}=this,n=this.getGlBuffer(t);s.bindBuffer(n.type,n.buffer)}bindBufferBase(t,s){const{L:n}=this;this.N[s]!==t&&(this.N[s]=t,t.p=s,n.bindBufferBase(n.UNIFORM_BUFFER,s,t.buffer))}nextBindBase(t){this.G++,this.B=0,t&&(this.N[0]=null,this.B=1,this.O<1&&(this.O=1))}freeLocationForBufferBase(t){let s=this.getLastBindBaseLocation(t);if(s>=this.B)return t.T=this.G,s;let n=0,i=this.O;for(;n<2;){i>=this.D&&(i=this.B,n++);const t=this.N[i];if(!t||t.T!==this.G)break;i++}return s=i,this.O=i+1,n>=2?-1:(t.T=this.G,this.N[s]=null,s)}getLastBindBaseLocation(t){const s=t.p;return this.N[s]===t?s:-1}bindBufferRange(t,s,n,i){const{L:e}=this;n||(n=0),s||(s=0),this.N[s]=null,e.bindBufferRange(e.UNIFORM_BUFFER,s||0,t.buffer,256*n,i||256)}updateBuffer(t){const{L:s}=this,n=this.getGlBuffer(t);if(t.F===n.updateID)return n;n.updateID=t.F,s.bindBuffer(n.type,n.buffer);const i=t.data,e=t.descriptor.usage&T.S.STATIC?s.STATIC_DRAW:s.DYNAMIC_DRAW;return i?n.byteLength>=i.byteLength?s.bufferSubData(n.type,0,i,0,t.j/i.BYTES_PER_ELEMENT):(n.byteLength=i.byteLength,s.bufferData(n.type,i,e)):(n.byteLength=t.descriptor.size,s.bufferData(n.type,n.byteLength,e)),n}destroyAll(){const t=this.L;for(const s in this.A)t.deleteBuffer(this.A[s].buffer);this.A=Object.create(null)}onBufferDestroy(t,s){const n=this.A[t.uid],i=this.L;s||i.deleteBuffer(n.buffer),this.A[t.uid]=null}createGLBuffer(t){const{L:s}=this;let n=S.ARRAY_BUFFER;t.descriptor.usage&T.S.INDEX?n=S.ELEMENT_ARRAY_BUFFER:t.descriptor.usage&T.S.UNIFORM&&(n=S.UNIFORM_BUFFER);const i=new A(s.createBuffer(),n);return this.A[t.uid]=i,t.on("destroy",this.onBufferDestroy,this),i}resetState(){this.N=Object.create(null)}}w.extension={type:[i.Ag.WebGLSystem],name:"buffer"};var N=n(1761);const R=class t{constructor(t){this.supports={uint32Indices:!0,uniformBufferObject:!0,vertexArrayObject:!0,srgbTextures:!0,nonPowOf2wrapping:!0,msaa:!0,nonPowOf2mipmaps:!0},this.C=t,this.extensions=Object.create(null),this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.C.gl=t}init(s){s={...t.defaultOptions,...s};let n=this.multiView=s.multiView;if(s.context&&n&&((0,b.R)("Renderer created with both a context and multiview enabled. Disabling multiView as both cannot work together."),n=!1),this.canvas=n?N.e.get().createCanvas(this.C.canvas.width,this.C.canvas.height):this.C.view.canvas,s.context)this.initFromContext(s.context);else{const t=this.C.background.alpha<1,n=s.premultipliedAlpha??!0,i=s.antialias&&!this.C.backBuffer.useBackBuffer;this.createContext(s.preferWebGLVersion,{alpha:t,premultipliedAlpha:n,antialias:i,stencil:!0,preserveDrawingBuffer:s.preserveDrawingBuffer,powerPreference:s.powerPreference??"default"})}}ensureCanvasSize(t){if(!this.multiView)return void(t!==this.canvas&&(0,b.R)("multiView is disabled, but targetCanvas is not the main canvas"));const{canvas:s}=this;(s.width<t.width||s.height<t.height)&&(s.width=Math.max(t.width,t.width),s.height=Math.max(t.height,t.height))}initFromContext(t){this.gl=t,this.webGLVersion=t instanceof N.e.get().getWebGLRenderingContext()?1:2,this.getExtensions(),this.validateContext(t),this.C.runners.contextChange.emit(t);const s=this.C.view.canvas;s.addEventListener("webglcontextlost",this.handleContextLost,!1),s.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}createContext(t,s){let n;const i=this.canvas;if(2===t&&(n=i.getContext("webgl2",s)),!n&&(n=i.getContext("webgl",s),!n))throw new Error("This browser does not support WebGL. Try using the canvas renderer");this.gl=n,this.initFromContext(this.gl)}getExtensions(){const{gl:t}=this,s={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc"),rgtc:t.getExtension("EXT_texture_compression_rgtc"),loseContext:t.getExtension("WEBGL_lose_context")};if(1===this.webGLVersion)this.extensions={...s,drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear"),vertexAttribDivisorANGLE:t.getExtension("ANGLE_instanced_arrays"),srgb:t.getExtension("EXT_sRGB")};else{this.extensions={...s,colorBufferFloat:t.getExtension("EXT_color_buffer_float")};const n=t.getExtension("WEBGL_provoking_vertex");n&&n.provokingVertexWEBGL(n.FIRST_VERTEX_CONVENTION_WEBGL)}}handleContextLost(t){t.preventDefault(),this.X&&(this.X=!1,setTimeout(()=>{this.gl.isContextLost()&&this.extensions.loseContext?.restoreContext()},0))}handleContextRestored(){this.getExtensions(),this.C.runners.contextChange.emit(this.gl)}destroy(){const t=this.C.view.canvas;this.C=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),this.extensions.loseContext?.loseContext()}forceContextLoss(){this.extensions.loseContext?.loseContext(),this.X=!0}validateContext(t){const s=t.getContextAttributes();s&&!s.stencil&&(0,b.R)("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const n=this.supports,i=2===this.webGLVersion,e=this.extensions;n.uint32Indices=i||!!e.uint32ElementIndex,n.uniformBufferObject=i,n.vertexArrayObject=i||!!e.vertexArrayObject,n.srgbTextures=i||!!e.srgb,n.nonPowOf2wrapping=i,n.nonPowOf2mipmaps=i,n.msaa=i,n.uint32Indices||(0,b.R)("Provided WebGL context does not support 32 index buffer, large scenes may not render correctly")}};R.extension={type:[i.Ag.WebGLSystem],name:"context"},R.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:void 0,preferWebGLVersion:2,multiView:!1};let B=R;var O=n(8306),U=n(7084),G=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(G||{}),C=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(C||{}),I=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(I||{});const L={uint8x2:I.UNSIGNED_BYTE,uint8x4:I.UNSIGNED_BYTE,sint8x2:I.BYTE,sint8x4:I.BYTE,unorm8x2:I.UNSIGNED_BYTE,unorm8x4:I.UNSIGNED_BYTE,snorm8x2:I.BYTE,snorm8x4:I.BYTE,uint16x2:I.UNSIGNED_SHORT,uint16x4:I.UNSIGNED_SHORT,sint16x2:I.SHORT,sint16x4:I.SHORT,unorm16x2:I.UNSIGNED_SHORT,unorm16x4:I.UNSIGNED_SHORT,snorm16x2:I.SHORT,snorm16x4:I.SHORT,float16x2:I.HALF_FLOAT,float16x4:I.HALF_FLOAT,float32:I.FLOAT,float32x2:I.FLOAT,float32x3:I.FLOAT,float32x4:I.FLOAT,uint32:I.UNSIGNED_INT,uint32x2:I.UNSIGNED_INT,uint32x3:I.UNSIGNED_INT,uint32x4:I.UNSIGNED_INT,sint32:I.INT,sint32x2:I.INT,sint32x3:I.INT,sint32x4:I.INT};function M(t){return L[t]??L.float32}const P={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5};class D{constructor(t){this.H=Object.create(null),this.C=t,this.Y=null,this.J=null,this.hasVao=!0,this.hasInstance=!0,this.C.renderableGC.addManagedHash(this,"_geometryVaoHash")}contextChange(){const t=this.gl=this.C.gl;if(!this.C.context.supports.vertexArrayObject)throw new Error("[PixiJS] Vertex Array Objects are not supported on this device");const s=this.C.context.extensions.vertexArrayObject;s&&(t.createVertexArray=()=>s.createVertexArrayOES(),t.bindVertexArray=t=>s.bindVertexArrayOES(t),t.deleteVertexArray=t=>s.deleteVertexArrayOES(t));const n=this.C.context.extensions.vertexAttribDivisorANGLE;n&&(t.drawArraysInstanced=(t,s,i,e)=>{n.drawArraysInstancedANGLE(t,s,i,e)},t.drawElementsInstanced=(t,s,i,e,r)=>{n.drawElementsInstancedANGLE(t,s,i,e,r)},t.vertexAttribDivisor=(t,s)=>n.vertexAttribDivisorANGLE(t,s)),this.Y=null,this.J=null,this.H=Object.create(null)}bind(t,s){const n=this.gl;this.Y=t;const i=this.getVao(t,s);this.J!==i&&(this.J=i,n.bindVertexArray(i)),this.updateBuffers()}resetState(){this.unbind()}updateBuffers(){const t=this.Y,s=this.C.buffer;for(let n=0;n<t.buffers.length;n++){const i=t.buffers[n];s.updateBuffer(i)}}checkCompatibility(t,s){const n=t.attributes,i=s.Z;for(const t in i)if(!n[t])throw new Error(`shader and geometry incompatible, geometry missing the "${t}" attribute`)}getSignature(t,s){const n=t.attributes,i=s.Z,e=["g",t.uid];for(const t in n)i[t]&&e.push(t,i[t].location);return e.join("-")}getVao(t,s){return this.H[t.uid]?.[s.tt]||this.initGeometryVao(t,s)}initGeometryVao(t,s,n=!0){const i=this.C.gl,e=this.C.buffer;this.C.shader.st(s),this.checkCompatibility(t,s);const r=this.getSignature(t,s);this.H[t.uid]||(this.H[t.uid]=Object.create(null),t.on("destroy",this.onGeometryDestroy,this));const o=this.H[t.uid];let c=o[r];if(c)return o[s.tt]=c,c;(0,U.q)(t,s.Z);const a=t.buffers;c=i.createVertexArray(),i.bindVertexArray(c);for(let t=0;t<a.length;t++){const s=a[t];e.bind(s)}return this.activateVao(t,s),o[s.tt]=c,o[r]=c,i.bindVertexArray(null),c}onGeometryDestroy(t,s){const n=this.H[t.uid],i=this.gl;if(n){if(s)for(const t in n)this.J!==n[t]&&this.unbind(),i.deleteVertexArray(n[t]);this.H[t.uid]=null}}destroyAll(t=!1){const s=this.gl;for(const n in this.H){if(t)for(const t in this.H[n]){const i=this.H[n];this.J!==i&&this.unbind(),s.deleteVertexArray(i[t])}this.H[n]=null}}activateVao(t,s){const n=this.C.gl,i=this.C.buffer,e=t.attributes;t.indexBuffer&&i.bind(t.indexBuffer);let r=null;for(const t in e){const o=e[t],c=o.buffer,a=i.getGlBuffer(c),h=s.Z[t];if(h){r!==a&&(i.bind(c),r=a);const t=h.location;n.enableVertexAttribArray(t);const s=(0,O.m)(o.format),e=M(o.format);if("int"===h.format?.substring(1,4)?n.vertexAttribIPointer(t,s.size,e,o.stride,o.offset):n.vertexAttribPointer(t,s.size,e,s.normalised,o.stride,o.offset),o.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");{const s=o.divisor??1;n.vertexAttribDivisor(t,s)}}}}}draw(t,s,n,i){const{gl:e}=this.C,r=this.Y,o=P[t||r.topology];if(i??(i=r.instanceCount),r.indexBuffer){const t=r.indexBuffer.data.BYTES_PER_ELEMENT,c=2===t?e.UNSIGNED_SHORT:e.UNSIGNED_INT;1!==i?e.drawElementsInstanced(o,s||r.indexBuffer.data.length,c,(n||0)*t,i):e.drawElements(o,s||r.indexBuffer.data.length,c,(n||0)*t)}else 1!==i?e.drawArraysInstanced(o,n||0,s||r.getSize(),i):e.drawArrays(o,n||0,s||r.getSize());return this}unbind(){this.gl.bindVertexArray(null),this.J=null,this.Y=null}destroy(){this.C=null,this.gl=null,this.J=null,this.Y=null,this.H=null}}D.extension={type:[i.Ag.WebGLSystem],name:"geometry"};var F=n(6011),$=n(583),j=n(9113);const V=new F.V({attributes:{aPosition:[-1,-1,3,-1,-1,3]}}),k=class t{constructor(t){this.useBackBuffer=!1,this.nt=!1,this.C=t}init(s={}){const{useBackBuffer:n,antialias:i}={...t.defaultOptions,...s};this.useBackBuffer=n,this.it=i,this.C.context.supports.msaa||((0,b.R)("antialiasing, is not supported on when using the back buffer"),this.it=!1),this.et=d.U.for2d();const e=new j.M({vertex:"\n                attribute vec2 aPosition;\n                out vec2 vUv;\n\n                void main() {\n                    gl_Position = vec4(aPosition, 0.0, 1.0);\n\n                    vUv = (aPosition + 1.0) / 2.0;\n\n                    // flip dem UVs\n                    vUv.y = 1.0 - vUv.y;\n                }",fragment:"\n                in vec2 vUv;\n                out vec4 finalColor;\n\n                uniform sampler2D uTexture;\n\n                void main() {\n                    finalColor = texture(uTexture, vUv);\n                }",name:"big-triangle"});this.rt=new l.M({glProgram:e,resources:{uTexture:g.g.WHITE.source}})}renderStart(t){const s=this.C.renderTarget.getRenderTarget(t.target);if(this.nt=this.useBackBuffer&&!!s.isRoot,this.nt){const s=this.C.renderTarget.getRenderTarget(t.target);this.ot=s.colorTexture,t.target=this.ct(s.colorTexture)}}renderEnd(){this.ht()}ht(){const t=this.C;t.renderTarget.finishRenderPass(),this.nt&&(t.renderTarget.bind(this.ot,!1),this.rt.resources.uTexture=this.ut.source,t.encoder.draw({geometry:V,shader:this.rt,state:this.et}))}ct(t){return this.ut=this.ut||new g.g({source:new $.v({width:t.width,height:t.height,resolution:t.lt,antialias:this.it})}),this.ut.source.resize(t.width,t.height,t.lt),this.ut}destroy(){this.ut&&(this.ut.destroy(),this.ut=null)}};k.extension={type:[i.Ag.WebGLSystem],name:"backBuffer",priority:1},k.defaultOptions={useBackBuffer:!1};let W=k;class X{constructor(t){this.vt=15,this.C=t}setMask(t){this.vt!==t&&(this.vt=t,this.C.gl.colorMask(!!(8&t),!!(4&t),!!(2&t),!!(1&t)))}}X.extension={type:[i.Ag.WebGLSystem],name:"colorMask"};class z{constructor(t){this.commandFinished=Promise.resolve(),this.C=t}setGeometry(t,s){this.C.geometry.bind(t,s.glProgram)}finishRenderPass(){}draw(t){const s=this.C,{geometry:n,shader:i,state:e,skipSync:r,topology:o,size:c,start:a,instanceCount:h}=t;s.shader.bind(i,r),s.geometry.bind(n,s.shader.ft),e&&s.state.set(e),s.geometry.draw(o,c,a,h??n.instanceCount)}destroy(){this.C=null}}z.extension={type:[i.Ag.WebGLSystem],name:"encoder"};var H=n(6512);class Y{constructor(t){this.C=t}contextChange(){const t=this.C.gl;this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxBatchableTextures=(0,H.u)(this.maxTextures,t);const s=2===this.C.context.webGLVersion;this.maxUniformBindings=s?t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS):0}destroy(){}}Y.extension={type:[i.Ag.WebGLSystem],name:"limits"};var q=n(1172),J=n(1957);class Z{constructor(t){this.gt={enabled:!1,stencilReference:0,stencilMode:J.K.NONE},this.bt=Object.create(null),t.renderTarget.onRenderTargetChange.add(this)}contextChange(t){this.L=t,this._t={always:t.ALWAYS,never:t.NEVER,equal:t.EQUAL,"not-equal":t.NOTEQUAL,less:t.LESS,"less-equal":t.LEQUAL,greater:t.GREATER,"greater-equal":t.GEQUAL},this.dt={keep:t.KEEP,zero:t.ZERO,replace:t.REPLACE,invert:t.INVERT,"increment-clamp":t.INCR,"decrement-clamp":t.DECR,"increment-wrap":t.INCR_WRAP,"decrement-wrap":t.DECR_WRAP},this.resetState()}onRenderTargetChange(t){if(this.xt===t)return;this.xt=t;let s=this.bt[t.uid];s||(s=this.bt[t.uid]={stencilMode:J.K.DISABLED,stencilReference:0}),this.setStencilMode(s.stencilMode,s.stencilReference)}resetState(){this.gt.enabled=!1,this.gt.stencilMode=J.K.NONE,this.gt.stencilReference=0}setStencilMode(t,s){const n=this.bt[this.xt.uid],i=this.L,e=q.g[t],r=this.gt;n.stencilMode=t,n.stencilReference=s,t!==J.K.DISABLED?(this.gt.enabled||(this.gt.enabled=!0,i.enable(i.STENCIL_TEST)),t===r.stencilMode&&r.stencilReference===s||(r.stencilMode=t,r.stencilReference=s,i.stencilFunc(this._t[e.stencilBack.compare],s,255),i.stencilOp(i.KEEP,i.KEEP,this.dt[e.stencilBack.passOp]))):this.gt.enabled&&(this.gt.enabled=!1,i.disable(i.STENCIL_TEST))}}Z.extension={type:[i.Ag.WebGLSystem],name:"stencil"};var K=n(7047);const Q={f32:4,i32:4,"vec2<f32>":8,"vec3<f32>":12,"vec4<f32>":16,"vec2<i32>":8,"vec3<i32>":12,"vec4<i32>":16,"mat2x2<f32>":32,"mat3x3<f32>":48,"mat4x4<f32>":64};function tt(t){const s=t.map(t=>({data:t,offset:0,size:0}));let n=0,i=0;for(let t=0;t<s.length;t++){const e=s[t];if(n=Q[e.data.type],!n)throw new Error(`Unknown type ${e.data.type}`);e.data.size>1&&(n=Math.max(n,16)*e.data.size);const r=12===n?16:n;e.size=n;const o=i%16;i+=o>0&&16-o<r?(16-o)%16:(n-o%n)%n,e.offset=i,i+=n}return i=16*Math.ceil(i/16),{uboElements:s,size:i}}var st=n(6423),nt=n(1266);function it(t,s){const n=Math.max(Q[t.data.type]/16,1),i=t.data.value.length/t.data.size,e=(4-i%4)%4,r=t.data.type.indexOf("i32")>=0?"dataInt32":"data";return`\n        v = uv.${t.data.name};\n        offset += ${s};\n\n        arrayOffset = offset;\n\n        t = 0;\n\n        for(var i=0; i < ${t.data.size*n}; i++)\n        {\n            for(var j = 0; j < ${i}; j++)\n            {\n                ${r}[arrayOffset++] = v[t++];\n            }\n            ${0!==e?`arrayOffset += ${e};`:""}\n        }\n    `}function et(t){return(0,st.E)(t,"uboStd40",it,nt.g)}class rt extends K.W{constructor(){super({createUboElements:tt,generateUboSync:et})}}rt.extension={type:[i.Ag.WebGLSystem],name:"ubo"};var ot=n(7238),ct=n(9252),at=n(4884),ht=n(1257);class ut{constructor(){this.width=-1,this.height=-1,this.msaa=!1,this.msaaRenderBuffer=[]}}class lt{constructor(){this.Et=[0,0,0,0],this.yt=new ct.M}init(t,s){this.C=t,this.Tt=s,t.runners.contextChange.add(this)}contextChange(){this.Et=[0,0,0,0],this.yt=new ct.M}copyToTexture(t,s,n,i,e){const r=this.Tt,o=this.C,c=r.getGpuRenderTarget(t),a=o.gl;return this.finishRenderPass(t),a.bindFramebuffer(a.FRAMEBUFFER,c.resolveTargetFramebuffer),o.texture.bind(s,0),a.copyTexSubImage2D(a.TEXTURE_2D,0,e.x,e.y,n.x,n.y,i.width,i.height),s}startRenderPass(t,s=!0,n,i){const e=this.Tt,r=t.colorTexture,o=e.getGpuRenderTarget(t);let c=i.y;t.isRoot&&(c=r.pixelHeight-i.height),t.colorTextures.forEach(t=>{this.C.texture.unbind(t)});const a=this.C.gl;a.bindFramebuffer(a.FRAMEBUFFER,o.framebuffer);const h=this.yt;h.x===i.x&&h.y===c&&h.width===i.width&&h.height===i.height||(h.x=i.x,h.y=c,h.width=i.width,h.height=i.height,a.viewport(i.x,c,i.width,i.height)),o.depthStencilRenderBuffer||!t.stencil&&!t.depth||this.St(o),this.clear(t,s,n)}finishRenderPass(t){const s=this.Tt.getGpuRenderTarget(t);if(!s.msaa)return;const n=this.C.gl;n.bindFramebuffer(n.FRAMEBUFFER,s.resolveTargetFramebuffer),n.bindFramebuffer(n.READ_FRAMEBUFFER,s.framebuffer),n.blitFramebuffer(0,0,s.width,s.height,0,0,s.width,s.height,n.COLOR_BUFFER_BIT,n.NEAREST),n.bindFramebuffer(n.FRAMEBUFFER,s.framebuffer)}initGpuRenderTarget(t){const s=this.C.gl,n=new ut;return t.colorTexture instanceof at.q?(this.C.context.ensureCanvasSize(t.colorTexture.resource),n.framebuffer=null,n):(this.At(t,n),s.bindFramebuffer(s.FRAMEBUFFER,null),n)}destroyGpuRenderTarget(t){const s=this.C.gl;t.framebuffer&&(s.deleteFramebuffer(t.framebuffer),t.framebuffer=null),t.resolveTargetFramebuffer&&(s.deleteFramebuffer(t.resolveTargetFramebuffer),t.resolveTargetFramebuffer=null),t.depthStencilRenderBuffer&&(s.deleteRenderbuffer(t.depthStencilRenderBuffer),t.depthStencilRenderBuffer=null),t.msaaRenderBuffer.forEach(t=>{s.deleteRenderbuffer(t)}),t.msaaRenderBuffer=null}clear(t,s,n){if(!s)return;const i=this.Tt;"boolean"==typeof s&&(s=s?ht.u.ALL:ht.u.NONE);const e=this.C.gl;if(s&ht.u.COLOR){n??(n=i.defaultClearColor);const t=this.Et,s=n;t[0]===s[0]&&t[1]===s[1]&&t[2]===s[2]&&t[3]===s[3]||(t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],e.clearColor(s[0],s[1],s[2],s[3]))}e.clear(s)}resizeGpuRenderTarget(t){if(t.isRoot)return;const s=this.Tt.getGpuRenderTarget(t);this.wt(t,s),(t.stencil||t.depth)&&this.Nt(s)}At(t,s){const n=this.C,i=n.gl,e=i.createFramebuffer();if(s.resolveTargetFramebuffer=e,i.bindFramebuffer(i.FRAMEBUFFER,e),s.width=t.colorTexture.source.pixelWidth,s.height=t.colorTexture.source.pixelHeight,t.colorTextures.forEach((t,e)=>{const r=t.source;r.antialias&&(n.context.supports.msaa?s.msaa=!0:(0,b.R)("[RenderTexture] Antialiasing on textures is not supported in WebGL1")),n.texture.bindSource(r,0);const o=n.texture.getGlSource(r).texture;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+e,3553,o,0)}),s.msaa){const n=i.createFramebuffer();s.framebuffer=n,i.bindFramebuffer(i.FRAMEBUFFER,n),t.colorTextures.forEach((t,n)=>{const e=i.createRenderbuffer();s.msaaRenderBuffer[n]=e})}else s.framebuffer=e;this.wt(t,s)}wt(t,s){const n=t.colorTexture.source;if(s.width=n.pixelWidth,s.height=n.pixelHeight,t.colorTextures.forEach((t,s)=>{0!==s&&t.source.resize(n.width,n.height,n.lt)}),s.msaa){const n=this.C,i=n.gl,e=s.framebuffer;i.bindFramebuffer(i.FRAMEBUFFER,e),t.colorTextures.forEach((t,e)=>{const r=t.source;n.texture.bindSource(r,0);const o=n.texture.getGlSource(r).internalFormat,c=s.msaaRenderBuffer[e];i.bindRenderbuffer(i.RENDERBUFFER,c),i.renderbufferStorageMultisample(i.RENDERBUFFER,4,o,r.pixelWidth,r.pixelHeight),i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+e,i.RENDERBUFFER,c)})}}St(t){if(null===t.framebuffer)return;const s=this.C.gl,n=s.createRenderbuffer();t.depthStencilRenderBuffer=n,s.bindRenderbuffer(s.RENDERBUFFER,n),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,n),this.Nt(t)}Nt(t){const s=this.C.gl;s.bindRenderbuffer(s.RENDERBUFFER,t.depthStencilRenderBuffer),t.msaa?s.renderbufferStorageMultisample(s.RENDERBUFFER,4,s.DEPTH24_STENCIL8,t.width,t.height):s.renderbufferStorage(s.RENDERBUFFER,2===this.C.context.webGLVersion?s.DEPTH24_STENCIL8:s.DEPTH_STENCIL,t.width,t.height)}prerender(t){const s=t.colorTexture.resource;this.C.context.multiView&&at.q.test(s)&&this.C.context.ensureCanvasSize(s)}postrender(t){if(this.C.context.multiView&&at.q.test(t.colorTexture.resource)){const s=this.C.context.canvas,n=t.colorTexture;n.context2D.drawImage(s,0,n.pixelHeight-s.height)}}}class vt extends ot.l{constructor(t){super(t),this.adaptor=new lt,this.adaptor.init(t,this)}}vt.extension={type:[i.Ag.WebGLSystem],name:"renderTarget"};var ft=n(581);class mt{constructor(t,s){this.program=t,this.uniformData=s,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}function gt(t,s,n){const i=t.createShader(s);return t.shaderSource(i,n),t.compileShader(i),i}function bt(t){const s=new Array(t);for(let t=0;t<s.length;t++)s[t]=!1;return s}function _t(t,s){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*s);case"vec3":return new Float32Array(3*s);case"vec4":return new Float32Array(4*s);case"ivec2":return new Int32Array(2*s);case"ivec3":return new Int32Array(3*s);case"ivec4":return new Int32Array(4*s);case"uvec2":return new Uint32Array(2*s);case"uvec3":return new Uint32Array(3*s);case"uvec4":return new Uint32Array(4*s);case"bool":return!1;case"bvec2":return bt(2*s);case"bvec3":return bt(3*s);case"bvec4":return bt(4*s);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}let dt=null;const xt={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"},pt={float:"float32",vec2:"float32x2",vec3:"float32x3",vec4:"float32x4",int:"sint32",ivec2:"sint32x2",ivec3:"sint32x3",ivec4:"sint32x4",uint:"uint32",uvec2:"uint32x2",uvec3:"uint32x3",uvec4:"uint32x4",bool:"uint32",bvec2:"uint32x2",bvec3:"uint32x3",bvec4:"uint32x4"};function Et(t,s){if(!dt){const s=Object.keys(xt);dt={};for(let n=0;n<s.length;++n){const i=s[n];dt[t[i]]=xt[i]}}return dt[s]}function yt(t,s){const n=Et(t,s);return pt[n]||"float32"}function Tt(t,s){const n=t.getShaderSource(s).split("\n").map((t,s)=>`${s}: ${t}`),i=t.getShaderInfoLog(s),e=i.split("\n"),r={},o=e.map(t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(t=>!(!t||r[t]||(r[t]=!0,0))),c=[""];o.forEach(t=>{n[t-1]=`%c${n[t-1]}%c`,c.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const a=n.join("\n");c[0]=a,console.error(i),console.groupCollapsed("click to view full shader code"),console.warn(...c),console.groupEnd()}const St={textureCount:0,blockIndex:0};class At{constructor(t){this.ft=null,this.Rt=Object.create(null),this.Bt=Object.create(null),this.C=t,this.C.renderableGC.addManagedHash(this,"_programDataHash")}contextChange(t){this.L=t,this.Rt=Object.create(null),this.Bt=Object.create(null),this.ft=null}bind(t,s){if(this.Ot(t.glProgram),s)return;St.textureCount=0,St.blockIndex=0;let n=this.Bt[t.glProgram.tt];n||(n=this.Bt[t.glProgram.tt]=this.Ut(t,this)),this.C.buffer.nextBindBase(!!t.glProgram.transformFeedbackVaryings),n(this.C,t,St)}updateUniformGroup(t){this.C.uniformGroup.updateUniformGroup(t,this.ft,St)}bindUniformBlock(t,s,n=0){const i=this.C.buffer,e=this.st(this.ft),r=t.Gt;r||this.C.ubo.updateUniformGroup(t);const o=t.buffer,c=i.updateBuffer(o),a=i.freeLocationForBufferBase(c);if(r){const{offset:s,size:n}=t;0===s&&n===o.data.byteLength?i.bindBufferBase(c,a):i.bindBufferRange(c,a,s)}else i.getLastBindBaseLocation(c)!==a&&i.bindBufferBase(c,a);const h=this.ft.Ct[s].index;e.uniformBlockBindings[n]!==a&&(e.uniformBlockBindings[n]=a,this.C.gl.uniformBlockBinding(e.program,h,a))}Ot(t){if(this.ft===t)return;this.ft=t;const s=this.st(t);this.L.useProgram(s.program)}st(t){return this.Rt[t.tt]||this.It(t)}It(t){const s=t.tt;return this.Rt[s]=function(t,s){const n=gt(t,t.VERTEX_SHADER,s.vertex),i=gt(t,t.FRAGMENT_SHADER,s.fragment),e=t.createProgram();t.attachShader(e,n),t.attachShader(e,i);const r=s.transformFeedbackVaryings;r&&("function"!=typeof t.transformFeedbackVaryings?(0,b.R)("TransformFeedback is not supported but TransformFeedbackVaryings are given."):t.transformFeedbackVaryings(e,r.names,"separate"===r.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(e),t.getProgramParameter(e,t.LINK_STATUS)||function(t,s,n,i){t.getProgramParameter(s,t.LINK_STATUS)||(t.getShaderParameter(n,t.COMPILE_STATUS)||Tt(t,n),t.getShaderParameter(i,t.COMPILE_STATUS)||Tt(t,i),console.error("PixiJS Error: Could not initialize shader."),""!==t.getProgramInfoLog(s)&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",t.getProgramInfoLog(s)))}(t,e,n,i),s.Z=function(t,s,n=!1){const i={},e=s.getProgramParameter(t,s.ACTIVE_ATTRIBUTES);for(let n=0;n<e;n++){const e=s.getActiveAttrib(t,n);if(e.name.startsWith("gl_"))continue;const r=yt(s,e.type);i[e.name]={location:0,format:r,stride:(0,O.m)(r).stride,offset:0,instance:!1,start:0}}const r=Object.keys(i);if(n){r.sort((t,s)=>t>s?1:-1);for(let n=0;n<r.length;n++)i[r[n]].location=n,s.bindAttribLocation(t,n,r[n]);s.linkProgram(t)}else for(let n=0;n<r.length;n++)i[r[n]].location=s.getAttribLocation(t,r[n]);return i}(e,t,!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(s.vertex)),s.Lt=function(t,s){const n={},i=s.getProgramParameter(t,s.ACTIVE_UNIFORMS);for(let e=0;e<i;e++){const i=s.getActiveUniform(t,e),r=i.name.replace(/\[.*?\]$/,""),o=!!i.name.match(/\[.*?\]$/),c=Et(s,i.type);n[r]={name:r,index:e,type:c,size:i.size,isArray:o,value:_t(c,i.size)}}return n}(e,t),s.Ct=function(t,s){if(!s.ACTIVE_UNIFORM_BLOCKS)return{};const n={},i=s.getProgramParameter(t,s.ACTIVE_UNIFORM_BLOCKS);for(let e=0;e<i;e++){const i=s.getActiveUniformBlockName(t,e),r=s.getUniformBlockIndex(t,i),o=s.getActiveUniformBlockParameter(t,e,s.UNIFORM_BLOCK_DATA_SIZE);n[i]={name:i,index:r,size:o}}return n}(e,t),t.deleteShader(n),t.deleteShader(i);const o={};for(const n in s.Lt){const i=s.Lt[n];o[n]={location:t.getUniformLocation(e,n),value:_t(i.type,i.size)}}return new mt(e,o)}(this.L,t),this.Rt[s]}destroy(){for(const t of Object.keys(this.Rt))this.Rt[t].destroy(),this.Rt[t]=null;this.Rt=null,this.Bt=null,this.ft=null,this.C=null,this.L=null}Ut(t,s){return function(t,s){const n=[],i=["\n        var g = s.groups;\n        var sS = r.shader;\n        var p = s.glProgram;\n        var ugS = r.uniformGroup;\n        var resources;\n    "];let e=!1,r=0;const o=s.st(t.glProgram);for(const c in t.groups){const a=t.groups[c];n.push(`\n            resources = g[${c}].resources;\n        `);for(const h in a.resources){const u=a.resources[h];if(u instanceof v.k)if(u.ubo){const s=t.Mt[c][Number(h)];n.push(`\n                        sS.bindUniformBlock(\n                            resources[${h}],\n                            '${s}',\n                            ${t.glProgram.Ct[s].index}\n                        );\n                    `)}else n.push(`\n                        ugS.updateUniformGroup(resources[${h}], p, sD);\n                    `);else if(u instanceof ft.d){const s=t.Mt[c][Number(h)];n.push(`\n                    sS.bindUniformBlock(\n                        resources[${h}],\n                        '${s}',\n                        ${t.glProgram.Ct[s].index}\n                    );\n                `)}else if(u instanceof $.v){const a=t.Mt[c][h],u=o.uniformData[a];u&&(e||(e=!0,i.push("\n                        var tS = r.texture;\n                        ")),s.L.uniform1i(u.location,r),n.push(`\n                        tS.bind(resources[${h}], ${r});\n                    `),r++)}}}const c=[...i,...n].join("\n");return new Function("r","s","sD",c)}(t,s)}resetState(){this.ft=null}}At.extension={type:[i.Ag.WebGLSystem],name:"shader"};var wt=n(8166);const Nt={f32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1f(location, v);\n        }","vec2<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2f(location, v[0], v[1]);\n        }","vec3<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3f(location, v[0], v[1], v[2]);\n        }","vec4<f32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n        }",i32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1i(location, v);\n        }","vec2<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2i(location, v[0], v[1]);\n        }","vec3<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3i(location, v[0], v[1], v[2]);\n        }","vec4<i32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n        }",u32:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1ui(location, v);\n        }","vec2<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2ui(location, v[0], v[1]);\n        }","vec3<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3ui(location, v[0], v[1], v[2]);\n        }","vec4<u32>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n        }",bool:"if (cv !== v) {\n            cu.value = v;\n            gl.uniform1i(location, v);\n        }","vec2<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            gl.uniform2i(location, v[0], v[1]);\n        }","vec3<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            gl.uniform3i(location, v[0], v[1], v[2]);\n        }","vec4<bool>":"if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {\n            cv[0] = v[0];\n            cv[1] = v[1];\n            cv[2] = v[2];\n            cv[3] = v[3];\n            gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n        }","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);"},Rt={f32:"gl.uniform1fv(location, v);","vec2<f32>":"gl.uniform2fv(location, v);","vec3<f32>":"gl.uniform3fv(location, v);","vec4<f32>":"gl.uniform4fv(location, v);","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);",i32:"gl.uniform1iv(location, v);","vec2<i32>":"gl.uniform2iv(location, v);","vec3<i32>":"gl.uniform3iv(location, v);","vec4<i32>":"gl.uniform4iv(location, v);",u32:"gl.uniform1iv(location, v);","vec2<u32>":"gl.uniform2iv(location, v);","vec3<u32>":"gl.uniform3iv(location, v);","vec4<u32>":"gl.uniform4iv(location, v);",bool:"gl.uniform1iv(location, v);","vec2<bool>":"gl.uniform2iv(location, v);","vec3<bool>":"gl.uniform3iv(location, v);","vec4<bool>":"gl.uniform4iv(location, v);"};class Bt{constructor(t){this.Pt={},this.Dt={},this.C=t,this.gl=null,this.Pt={}}contextChange(t){this.gl=t}updateUniformGroup(t,s,n){const i=this.C.shader.st(s);t.isStatic&&t.Ft===i.uniformDirtyGroups[t.uid]||(i.uniformDirtyGroups[t.uid]=t.Ft,this.$t(t,s)(i.uniformData,t.uniforms,this.C,n))}$t(t,s){return this.Dt[t.jt]?.[s.tt]||this.Vt(t,s)}Vt(t,s){const n=this.Dt[t.jt]||(this.Dt[t.jt]={}),i=this.kt(t,s.Lt,"u");return this.Pt[i]||(this.Pt[i]=this.Wt(t,s.Lt)),n[s.tt]=this.Pt[i],n[s.tt]}Wt(t,s){return function(t,s){const n=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n        var name = null;\n    "];for(const i in t.uniforms){if(!s[i]){t.uniforms[i]instanceof v.k?t.uniforms[i].ubo?n.push(`\n                        renderer.shader.bindUniformBlock(uv.${i}, "${i}");\n                    `):n.push(`\n                        renderer.shader.updateUniformGroup(uv.${i});\n                    `):t.uniforms[i]instanceof ft.d&&n.push(`\n                        renderer.shader.bindBufferResource(uv.${i}, "${i}");\n                    `);continue}const e=t.uniformStructures[i];let r=!1;for(let t=0;t<wt.$.length;t++){const s=wt.$[t];if(e.type===s.type&&s.test(e)){n.push(`name = "${i}";`,wt.$[t].uniform),r=!0;break}}if(!r){const t=(1===e.size?Nt:Rt)[e.type].replace("location",`ud["${i}"].location`);n.push(`\n            cu = ud["${i}"];\n            cv = cu.value;\n            v = uv["${i}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",n.join("\n"))}(t,s)}kt(t,s,n){const i=t.uniforms,e=[`${n}-`];for(const t in i)e.push(t),s[t]&&e.push(s[t].type);return e.join("-")}destroy(){this.C=null,this.Pt=null}}Bt.extension={type:[i.Ag.WebGLSystem],name:"uniformGroup"};const Ot=class t{constructor(t){this.Xt=!1,this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this.zt=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=d.U.for2d(),t.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(t){this.Xt=!t.isRoot,this.Ht?this.setFrontFace(this.Yt):this.qt=!0}contextChange(t){this.gl=t,this.blendModesMap=function(t){const s={};if(s.normal=[t.ONE,t.ONE_MINUS_SRC_ALPHA],s.add=[t.ONE,t.ONE],s.multiply=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],s.screen=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],s.none=[0,0],s["normal-npm"]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],s["add-npm"]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],s["screen-npm"]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],s.erase=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],t instanceof N.e.get().getWebGLRenderingContext()){const n=t.getExtension("EXT_blend_minmax");n&&(s.min=[t.ONE,t.ONE,t.ONE,t.ONE,n.MIN_EXT,n.MIN_EXT],s.max=[t.ONE,t.ONE,t.ONE,t.ONE,n.MAX_EXT,n.MAX_EXT])}else s.min=[t.ONE,t.ONE,t.ONE,t.ONE,t.MIN,t.MIN],s.max=[t.ONE,t.ONE,t.ONE,t.ONE,t.MAX,t.MAX];return s}(t),this.resetState()}set(t){if(t||(t=this.defaultState),this.stateId!==t.data){let s=this.stateId^t.data,n=0;for(;s;)1&s&&this.map[n].call(this,!!(t.data&1<<n)),s>>=1,n++;this.stateId=t.data}for(let s=0;s<this.checks.length;s++)this.checks[s](this,t)}forceState(t){t||(t=this.defaultState);for(let s=0;s<this.map.length;s++)this.map[s].call(this,!!(t.data&1<<s));for(let s=0;s<this.checks.length;s++)this.checks[s](this,t);this.stateId=t.data}setBlend(s){this.Jt(t.Zt,s),this.gl[s?"enable":"disable"](this.gl.BLEND)}setOffset(s){this.Jt(t.Kt,s),this.gl[s?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.Ht=t,this.gl[t?"enable":"disable"](this.gl.CULL_FACE),this.Ht&&this.qt&&this.setFrontFace(this.Yt)}setFrontFace(t){this.Yt=t,this.qt=!1;const s=this.Xt?!t:t;this.Qt!==s&&(this.Qt=s,this.gl.frontFace(this.gl[s?"CW":"CCW"]))}setBlendMode(t){if(this.blendModesMap[t]||(t="normal"),t===this.blendMode)return;this.blendMode=t;const s=this.blendModesMap[t],n=this.gl;2===s.length?n.blendFunc(s[0],s[1]):n.blendFuncSeparate(s[0],s[1],s[2],s[3]),6===s.length?(this.zt=!0,n.blendEquationSeparate(s[4],s[5])):this.zt&&(this.zt=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}setPolygonOffset(t,s){this.gl.polygonOffset(t,s)}resetState(){this.Qt=!1,this.Yt=!1,this.Ht=!1,this.qt=!1,this.Xt=!1,this.gl.frontFace(this.gl.CCW),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this.zt=!0,this.blendMode="",this.setBlendMode("normal")}Jt(t,s){const n=this.checks.indexOf(t);s&&-1===n?this.checks.push(t):s||-1===n||this.checks.splice(n,1)}static Zt(t,s){t.setBlendMode(s.blendMode)}static Kt(t,s){t.setPolygonOffset(1,s.polygonOffset)}destroy(){this.gl=null,this.checks.length=0}};Ot.extension={type:[i.Ag.WebGLSystem],name:"state"};let Ut=Ot;class Gt{constructor(t){this.target=C.TEXTURE_2D,this.texture=t,this.width=-1,this.height=-1,this.type=I.UNSIGNED_BYTE,this.internalFormat=G.RGBA,this.format=G.RGBA,this.samplerType=0}}const Ct={id:"buffer",upload(t,s,n){s.width===t.width||s.height===t.height?n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,s.format,s.type,t.resource):n.texImage2D(s.target,0,s.internalFormat,t.width,t.height,0,s.format,s.type,t.resource),s.width=t.width,s.height=t.height}},It={"bc1-rgba-unorm":!0,"bc1-rgba-unorm-srgb":!0,"bc2-rgba-unorm":!0,"bc2-rgba-unorm-srgb":!0,"bc3-rgba-unorm":!0,"bc3-rgba-unorm-srgb":!0,"bc4-r-unorm":!0,"bc4-r-snorm":!0,"bc5-rg-unorm":!0,"bc5-rg-snorm":!0,"bc6h-rgb-ufloat":!0,"bc6h-rgb-float":!0,"bc7-rgba-unorm":!0,"bc7-rgba-unorm-srgb":!0,"etc2-rgb8unorm":!0,"etc2-rgb8unorm-srgb":!0,"etc2-rgb8a1unorm":!0,"etc2-rgb8a1unorm-srgb":!0,"etc2-rgba8unorm":!0,"etc2-rgba8unorm-srgb":!0,"eac-r11unorm":!0,"eac-r11snorm":!0,"eac-rg11unorm":!0,"eac-rg11snorm":!0,"astc-4x4-unorm":!0,"astc-4x4-unorm-srgb":!0,"astc-5x4-unorm":!0,"astc-5x4-unorm-srgb":!0,"astc-5x5-unorm":!0,"astc-5x5-unorm-srgb":!0,"astc-6x5-unorm":!0,"astc-6x5-unorm-srgb":!0,"astc-6x6-unorm":!0,"astc-6x6-unorm-srgb":!0,"astc-8x5-unorm":!0,"astc-8x5-unorm-srgb":!0,"astc-8x6-unorm":!0,"astc-8x6-unorm-srgb":!0,"astc-8x8-unorm":!0,"astc-8x8-unorm-srgb":!0,"astc-10x5-unorm":!0,"astc-10x5-unorm-srgb":!0,"astc-10x6-unorm":!0,"astc-10x6-unorm-srgb":!0,"astc-10x8-unorm":!0,"astc-10x8-unorm-srgb":!0,"astc-10x10-unorm":!0,"astc-10x10-unorm-srgb":!0,"astc-12x10-unorm":!0,"astc-12x10-unorm-srgb":!0,"astc-12x12-unorm":!0,"astc-12x12-unorm-srgb":!0},Lt={id:"compressed",upload(t,s,n){n.pixelStorei(n.UNPACK_ALIGNMENT,4);let i=t.pixelWidth,e=t.pixelHeight;const r=!!It[t.format];for(let o=0;o<t.resource.length;o++){const c=t.resource[o];r?n.compressedTexImage2D(n.TEXTURE_2D,o,s.internalFormat,i,e,0,c):n.texImage2D(n.TEXTURE_2D,o,s.internalFormat,i,e,0,s.format,s.type,c),i=Math.max(i>>1,1),e=Math.max(e>>1,1)}}},Mt={id:"image",upload(t,s,n,i){const e=s.width,r=s.height,o=t.pixelWidth,c=t.pixelHeight,a=t.resourceWidth,h=t.resourceHeight;a<o||h<c?(e===o&&r===c||n.texImage2D(s.target,0,s.internalFormat,o,c,0,s.format,s.type,null),2===i?n.texSubImage2D(n.TEXTURE_2D,0,0,0,a,h,s.format,s.type,t.resource):n.texSubImage2D(n.TEXTURE_2D,0,0,0,s.format,s.type,t.resource)):e===o&&r===c?n.texSubImage2D(n.TEXTURE_2D,0,0,0,s.format,s.type,t.resource):2===i?n.texImage2D(s.target,0,s.internalFormat,o,c,0,s.format,s.type,t.resource):n.texImage2D(s.target,0,s.internalFormat,s.format,s.type,t.resource),s.width=o,s.height=c}},Pt={id:"video",upload(t,s,n,i){t.isValid?Mt.upload(t,s,n,i):n.texImage2D(s.target,0,s.internalFormat,1,1,0,s.format,s.type,null)}},Dt={linear:9729,nearest:9728},Ft={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},$t={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},jt={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519};function Vt(t,s,n,i,e,r,o,c){const a=r;if(!c||"repeat"!==t.addressModeU||"repeat"!==t.addressModeV||"repeat"!==t.addressModeW){const n=$t[o?"clamp-to-edge":t.addressModeU],i=$t[o?"clamp-to-edge":t.addressModeV],r=$t[o?"clamp-to-edge":t.addressModeW];s[e](a,s.TEXTURE_WRAP_S,n),s[e](a,s.TEXTURE_WRAP_T,i),s.TEXTURE_WRAP_R&&s[e](a,s.TEXTURE_WRAP_R,r)}if(c&&"linear"===t.magFilter||s[e](a,s.TEXTURE_MAG_FILTER,Dt[t.magFilter]),n){if(!c||"linear"!==t.mipmapFilter){const n=Ft[t.minFilter][t.mipmapFilter];s[e](a,s.TEXTURE_MIN_FILTER,n)}}else s[e](a,s.TEXTURE_MIN_FILTER,Dt[t.minFilter]);if(i&&t.maxAnisotropy>1){const n=Math.min(t.maxAnisotropy,s.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT));s[e](a,i.TEXTURE_MAX_ANISOTROPY_EXT,n)}t.compare&&s[e](a,s.TEXTURE_COMPARE_FUNC,jt[t.compare])}class kt{constructor(t){this.managedTextures=[],this.ts=Object.create(null),this.ss=Object.create(null),this.ns=[],this.es=-1,this.rs=Object.create(null),this.cs={image:Mt,buffer:Ct,video:Pt,compressed:Lt},this.hs=!1,this.us=!1,this.C=t,this.C.renderableGC.addManagedHash(this,"_glTextures"),this.C.renderableGC.addManagedHash(this,"_glSamplers")}contextChange(t){this.L=t,this.ls||(this.ls=function(t,s){let n={},i=t.RGBA;return t instanceof N.e.get().getWebGLRenderingContext()?s.srgb&&(n={"rgba8unorm-srgb":s.srgb.SRGB8_ALPHA8_EXT,"bgra8unorm-srgb":s.srgb.SRGB8_ALPHA8_EXT}):(n={"rgba8unorm-srgb":t.SRGB8_ALPHA8,"bgra8unorm-srgb":t.SRGB8_ALPHA8},i=t.RGBA8),{r8unorm:t.R8,r8snorm:t.R8_SNORM,r8uint:t.R8UI,r8sint:t.R8I,r16uint:t.R16UI,r16sint:t.R16I,r16float:t.R16F,rg8unorm:t.RG8,rg8snorm:t.RG8_SNORM,rg8uint:t.RG8UI,rg8sint:t.RG8I,r32uint:t.R32UI,r32sint:t.R32I,r32float:t.R32F,rg16uint:t.RG16UI,rg16sint:t.RG16I,rg16float:t.RG16F,rgba8unorm:t.RGBA,...n,rgba8snorm:t.RGBA8_SNORM,rgba8uint:t.RGBA8UI,rgba8sint:t.RGBA8I,bgra8unorm:i,rgb9e5ufloat:t.RGB9_E5,rgb10a2unorm:t.RGB10_A2,rg11b10ufloat:t.R11F_G11F_B10F,rg32uint:t.RG32UI,rg32sint:t.RG32I,rg32float:t.RG32F,rgba16uint:t.RGBA16UI,rgba16sint:t.RGBA16I,rgba16float:t.RGBA16F,rgba32uint:t.RGBA32UI,rgba32sint:t.RGBA32I,rgba32float:t.RGBA32F,stencil8:t.STENCIL_INDEX8,depth16unorm:t.DEPTH_COMPONENT16,depth24plus:t.DEPTH_COMPONENT24,"depth24plus-stencil8":t.DEPTH24_STENCIL8,depth32float:t.DEPTH_COMPONENT32F,"depth32float-stencil8":t.DEPTH32F_STENCIL8,...s.s3tc?{"bc1-rgba-unorm":s.s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT,"bc2-rgba-unorm":s.s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT,"bc3-rgba-unorm":s.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT}:{},...s.s3tc_sRGB?{"bc1-rgba-unorm-srgb":s.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,"bc2-rgba-unorm-srgb":s.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,"bc3-rgba-unorm-srgb":s.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}:{},...s.rgtc?{"bc4-r-unorm":s.rgtc.COMPRESSED_RED_RGTC1_EXT,"bc4-r-snorm":s.rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT,"bc5-rg-unorm":s.rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT,"bc5-rg-snorm":s.rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}:{},...s.bptc?{"bc6h-rgb-float":s.bptc.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,"bc6h-rgb-ufloat":s.bptc.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,"bc7-rgba-unorm":s.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,"bc7-rgba-unorm-srgb":s.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT}:{},...s.etc?{"etc2-rgb8unorm":s.etc.COMPRESSED_RGB8_ETC2,"etc2-rgb8unorm-srgb":s.etc.COMPRESSED_SRGB8_ETC2,"etc2-rgb8a1unorm":s.etc.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgb8a1unorm-srgb":s.etc.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgba8unorm":s.etc.COMPRESSED_RGBA8_ETC2_EAC,"etc2-rgba8unorm-srgb":s.etc.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,"eac-r11unorm":s.etc.COMPRESSED_R11_EAC,"eac-rg11unorm":s.etc.COMPRESSED_SIGNED_RG11_EAC}:{},...s.astc?{"astc-4x4-unorm":s.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,"astc-4x4-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,"astc-5x4-unorm":s.astc.COMPRESSED_RGBA_ASTC_5x4_KHR,"astc-5x4-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,"astc-5x5-unorm":s.astc.COMPRESSED_RGBA_ASTC_5x5_KHR,"astc-5x5-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,"astc-6x5-unorm":s.astc.COMPRESSED_RGBA_ASTC_6x5_KHR,"astc-6x5-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,"astc-6x6-unorm":s.astc.COMPRESSED_RGBA_ASTC_6x6_KHR,"astc-6x6-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,"astc-8x5-unorm":s.astc.COMPRESSED_RGBA_ASTC_8x5_KHR,"astc-8x5-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,"astc-8x6-unorm":s.astc.COMPRESSED_RGBA_ASTC_8x6_KHR,"astc-8x6-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,"astc-8x8-unorm":s.astc.COMPRESSED_RGBA_ASTC_8x8_KHR,"astc-8x8-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,"astc-10x5-unorm":s.astc.COMPRESSED_RGBA_ASTC_10x5_KHR,"astc-10x5-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,"astc-10x6-unorm":s.astc.COMPRESSED_RGBA_ASTC_10x6_KHR,"astc-10x6-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,"astc-10x8-unorm":s.astc.COMPRESSED_RGBA_ASTC_10x8_KHR,"astc-10x8-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,"astc-10x10-unorm":s.astc.COMPRESSED_RGBA_ASTC_10x10_KHR,"astc-10x10-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,"astc-12x10-unorm":s.astc.COMPRESSED_RGBA_ASTC_12x10_KHR,"astc-12x10-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,"astc-12x12-unorm":s.astc.COMPRESSED_RGBA_ASTC_12x12_KHR,"astc-12x12-unorm-srgb":s.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR}:{}}}(t,this.C.context.extensions),this.vs=function(t){return{r8unorm:t.UNSIGNED_BYTE,r8snorm:t.BYTE,r8uint:t.UNSIGNED_BYTE,r8sint:t.BYTE,r16uint:t.UNSIGNED_SHORT,r16sint:t.SHORT,r16float:t.HALF_FLOAT,rg8unorm:t.UNSIGNED_BYTE,rg8snorm:t.BYTE,rg8uint:t.UNSIGNED_BYTE,rg8sint:t.BYTE,r32uint:t.UNSIGNED_INT,r32sint:t.INT,r32float:t.FLOAT,rg16uint:t.UNSIGNED_SHORT,rg16sint:t.SHORT,rg16float:t.HALF_FLOAT,rgba8unorm:t.UNSIGNED_BYTE,"rgba8unorm-srgb":t.UNSIGNED_BYTE,rgba8snorm:t.BYTE,rgba8uint:t.UNSIGNED_BYTE,rgba8sint:t.BYTE,bgra8unorm:t.UNSIGNED_BYTE,"bgra8unorm-srgb":t.UNSIGNED_BYTE,rgb9e5ufloat:t.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:t.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:t.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:t.UNSIGNED_INT,rg32sint:t.INT,rg32float:t.FLOAT,rgba16uint:t.UNSIGNED_SHORT,rgba16sint:t.SHORT,rgba16float:t.HALF_FLOAT,rgba32uint:t.UNSIGNED_INT,rgba32sint:t.INT,rgba32float:t.FLOAT,stencil8:t.UNSIGNED_BYTE,depth16unorm:t.UNSIGNED_SHORT,depth24plus:t.UNSIGNED_INT,"depth24plus-stencil8":t.UNSIGNED_INT_24_8,depth32float:t.FLOAT,"depth32float-stencil8":t.FLOAT_32_UNSIGNED_INT_24_8_REV}}(t),this.fs=function(t){return{r8unorm:t.RED,r8snorm:t.RED,r8uint:t.RED,r8sint:t.RED,r16uint:t.RED,r16sint:t.RED,r16float:t.RED,rg8unorm:t.RG,rg8snorm:t.RG,rg8uint:t.RG,rg8sint:t.RG,r32uint:t.RED,r32sint:t.RED,r32float:t.RED,rg16uint:t.RG,rg16sint:t.RG,rg16float:t.RG,rgba8unorm:t.RGBA,"rgba8unorm-srgb":t.RGBA,rgba8snorm:t.RGBA,rgba8uint:t.RGBA,rgba8sint:t.RGBA,bgra8unorm:t.RGBA,"bgra8unorm-srgb":t.RGBA,rgb9e5ufloat:t.RGB,rgb10a2unorm:t.RGBA,rg11b10ufloat:t.RGB,rg32uint:t.RG,rg32sint:t.RG,rg32float:t.RG,rgba16uint:t.RGBA,rgba16sint:t.RGBA,rgba16float:t.RGBA,rgba32uint:t.RGBA,rgba32sint:t.RGBA,rgba32float:t.RGBA,stencil8:t.STENCIL_INDEX8,depth16unorm:t.DEPTH_COMPONENT,depth24plus:t.DEPTH_COMPONENT,"depth24plus-stencil8":t.DEPTH_STENCIL,depth32float:t.DEPTH_COMPONENT,"depth32float-stencil8":t.DEPTH_STENCIL}}(t)),this.ts=Object.create(null),this.ss=Object.create(null),this.rs=Object.create(null),this.hs=!1;for(let t=0;t<16;t++)this.bind(g.g.EMPTY,t)}initSource(t){this.bind(t)}bind(t,s=0){const n=t.source;t?(this.bindSource(n,s),this.us&&this.gs(n.style,s)):(this.bindSource(null,s),this.us&&this.gs(null,s))}bindSource(t,s=0){const n=this.L;if(t.bs=this.C.textureGC.count,this.ns[s]!==t){this.ns[s]=t,this._s(s),t||(t=g.g.EMPTY.source);const i=this.getGlSource(t);n.bindTexture(i.target,i.texture)}}gs(t,s=0){const n=this.L;if(!t)return this.rs[s]=null,void n.bindSampler(s,null);const i=this.ds(t);this.rs[s]!==i&&(this.rs[s]=i,n.bindSampler(s,i))}unbind(t){const s=t.source,n=this.ns,i=this.L;for(let t=0;t<n.length;t++)if(n[t]===s){this._s(t);const e=this.getGlSource(s);i.bindTexture(e.target,null),n[t]=null}}_s(t){this.es!==t&&(this.es=t,this.L.activeTexture(this.L.TEXTURE0+t))}xs(t){const s=this.L,n=new Gt(s.createTexture());if(n.type=this.vs[t.format],n.internalFormat=this.ls[t.format],n.format=this.fs[t.format],t.autoGenerateMipmaps&&(this.C.context.supports.nonPowOf2mipmaps||t.isPowerOfTwo)){const s=Math.max(t.width,t.height);t.mipLevelCount=Math.floor(Math.log2(s))+1}return this.ts[t.uid]=n,this.managedTextures.includes(t)||(t.on("update",this.onSourceUpdate,this),t.on("resize",this.onSourceUpdate,this),t.on("styleChange",this.onStyleChange,this),t.on("destroy",this.onSourceDestroy,this),t.on("unload",this.onSourceUnload,this),t.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(t)),this.onSourceUpdate(t),this.updateStyle(t,!1),n}onStyleChange(t){this.updateStyle(t,!1)}updateStyle(t,s){const n=this.L,i=this.getGlSource(t);n.bindTexture(n.TEXTURE_2D,i.texture),this.ns[this.es]=t,Vt(t.style,n,t.mipLevelCount>1,this.C.context.extensions.anisotropicFiltering,"texParameteri",n.TEXTURE_2D,!this.C.context.supports.nonPowOf2wrapping&&!t.isPowerOfTwo,s)}onSourceUnload(t){const s=this.ts[t.uid];s&&(this.unbind(t),this.ts[t.uid]=null,this.L.deleteTexture(s.texture))}onSourceUpdate(t){const s=this.L,n=this.getGlSource(t);s.bindTexture(s.TEXTURE_2D,n.texture),this.ns[this.es]=t;const i="premultiply-alpha-on-upload"===t.alphaMode;this.hs!==i&&(this.hs=i,s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i)),this.cs[t.uploadMethodId]?this.cs[t.uploadMethodId].upload(t,n,s,this.C.context.webGLVersion):s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t.pixelWidth,t.pixelHeight,0,s.RGBA,s.UNSIGNED_BYTE,null),t.autoGenerateMipmaps&&t.mipLevelCount>1&&this.onUpdateMipmaps(t,!1)}onUpdateMipmaps(t,s=!0){s&&this.bindSource(t,0);const n=this.getGlSource(t);this.L.generateMipmap(n.target)}onSourceDestroy(t){t.off("destroy",this.onSourceDestroy,this),t.off("update",this.onSourceUpdate,this),t.off("resize",this.onSourceUpdate,this),t.off("unload",this.onSourceUnload,this),t.off("styleChange",this.onStyleChange,this),t.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(t),1),this.onSourceUnload(t)}ps(t){const s=this.L,n=this.L.createSampler();return this.ss[t.Es]=n,Vt(t,s,this.ns[this.es].mipLevelCount>1,this.C.context.extensions.anisotropicFiltering,"samplerParameteri",n,!1,!0),this.ss[t.Es]}ds(t){return this.ss[t.Es]||this.ps(t)}getGlSource(t){return this.ts[t.uid]||this.xs(t)}generateCanvas(t){const{pixels:s,width:n,height:i}=this.getPixels(t),e=N.e.get().createCanvas();e.width=n,e.height=i;const r=e.getContext("2d");if(r){const t=r.createImageData(n,i);t.data.set(s),r.putImageData(t,0,0)}return e}getPixels(t){const s=t.source.resolution,n=t.frame,i=Math.max(Math.round(n.width*s),1),e=Math.max(Math.round(n.height*s),1),r=new Uint8Array(4*i*e),o=this.C,c=o.renderTarget.getRenderTarget(t),a=o.renderTarget.getGpuRenderTarget(c),h=o.gl;return h.bindFramebuffer(h.FRAMEBUFFER,a.resolveTargetFramebuffer),h.readPixels(Math.round(n.x*s),Math.round(n.y*s),i,e,h.RGBA,h.UNSIGNED_BYTE,r),{pixels:new Uint8ClampedArray(r.buffer),width:i,height:e}}destroy(){this.managedTextures.slice().forEach(t=>this.onSourceDestroy(t)),this.managedTextures=null,this.ts=null,this.ss=null,this.ns=null,this.rs=null,this.ls=null,this.vs=null,this.fs=null,this.cs=null,this.C=null}resetState(){this.es=-1,this.ns.fill(g.g.EMPTY.source),this.rs=Object.create(null);const t=this.L;this.hs=!1,t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.hs)}}kt.extension={type:[i.Ag.WebGLSystem],name:"texture"};const Wt=[...E.i,rt,W,B,Y,w,kt,vt,D,Bt,At,z,Ut,Z,X],Xt=[...E.f],zt=[x,_,f],Ht=[],Yt=[],qt=[];i.XO.handleByNamedList(i.Ag.WebGLSystem,Ht),i.XO.handleByNamedList(i.Ag.WebGLPipes,Yt),i.XO.handleByNamedList(i.Ag.WebGLPipesAdaptor,qt),i.XO.add(...Wt,...Xt,...zt);class Jt extends p.k{constructor(){super({name:"webgl",type:y.W.WEBGL,systems:Ht,renderPipes:Yt,renderPipeAdaptors:qt})}}}}]);